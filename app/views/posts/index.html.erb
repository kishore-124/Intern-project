<h1>Posts</h1>
<% if @posts.count == 0 %>
  <h3>No posts</h3>
<% else %>

  <%unless params[:topic_id] %>
  <%= form_tag(posts_url, method: 'get') do %>
    <%= text_field_tag(:search, params[:search]) %>
    <%= submit_tag("Search", name: nil) %>
    <%end %>
    <%end %>

  <%if params[:topic_id] %>
    <%=form_tag topic_posts_path, method: :get do %>From:
      <%=date_field_tag :start_date, Date.yesterday %>
      to: <%=date_field_tag :end_date, Date.today %>
      <%=submit_tag "show"%>
    <%end %>
    <%else %>
  <%=form_tag posts_path, method: :get do %>From:
    <%=date_field_tag :start_date, Date.yesterday %>
    to: <%=date_field_tag :end_date, Date.today %>
    <%=submit_tag "show"%>
  <%end %>
    <%end %>
  <table class="table table-striped table-dark">
    <tr>
      <th>User</th>
      <th>Name</th>
      <th>Description</th>
      <th>Read status</th>
      <th>Edit</th>
      <th>Delete</th>
    </tr>
    <% @posts.each do |post| %>
      <tr>
        <td><%=post.user.email %></td>
        <td><%= link_to post.name, topic_post_path(post.topic_id, post) %> <%= "(#{post.topic.title})" %></td>
        <td><%= link_to post.description, topic_post_path(post.topic_id, post) %>
        <td><%if  post.users.where(posts_users_read_status: {user_id:current_user.id,post_id:post.id}).present? %>
            <%='Read' %>
          <%end %>
        </td>
          <% if can? :update, post %>
          <td><%= link_to 'Edit', edit_topic_post_path(post.topic_id, post) , class:"btn btn-primary"%></td>
          <% end %>

        <% if can? :destroy, post %>
        <td><%= link_to 'Destroy', topic_post_path(post.topic_id, post),
                        method: :delete,
                        data: {confirm: 'Are you sure?'} , class:"btn btn-primary"%></td>
          <% end%>
      </tr>
    <% end %>
  </table>
  <% if @pagy.pages>1 %>
 <div  class="container pagination justify-content-center"><%==  pagy_bootstrap_nav @pagy  %></div>
    <%end %>
<% end %>